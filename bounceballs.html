<!DOCTYPE html>
<html>
<head>
  	<meta charset="utf-8">
  	<title>http://jsfiddle.net/inkfood/juzsR/</title>
	<style type='text/css'>
		body,html {
		    height: 100%;
		    margin:0px;
		    padding:0px;
		}

		#table {
			width: 800px;
			height: 400px;
			transform : translateZ(0); 
			background-color: darkgreen;
			overflow: hidden;
			border: 25px solid #552222;
			border-radius: 5%;
		    margin:0px;
		    padding:0px;
		}

		.ball {
			-webkit-transition: -webkit-transform linear;
		    -moz-transition: -moz-transform linear;
			transform : translateZ(0); 
			position: absolute;
			width: 30px;
			height: 30px;
			text-align: center;
			background:#004E99;
			border-radius:50%;
			box-shadow: 10px 30px 30px -10px rgba(0,0,0,0.4);
		}

		.ball>div{
			position:absolute;
			width:100%;
			height:100%;
			border-radius:50%;
		}

		.ball>div>span{
			position:absolute;
			left:9px;
			top:8px;
			width:15px;
			height:15px;
			border-radius:50%;
			text-align:center;
			line-height:15px;
			font-size:12px;
			font-weight:bold;
			background:#fff;
		}

		.ball.blue {
			background: radial-gradient(circle at 20px 20px, #09f, #001);
		}

	</style>

	<script type='text/javascript'>
		var ballsArray =[];
		var maxBalls = 5;
		var speedLimit = 14;
		var tableheight = 400;
		var tablewidth = 800;

		 window.requestAnimFrame = (function() {
		      return  window.requestAnimationFrame       || 
		              window.webkitRequestAnimationFrame || 
		              window.mozRequestAnimationFrame    || 
		              window.oRequestAnimationFrame      || 
		              window.msRequestAnimationFrame     || 
		              function(/* function */ callback, /* DOMElement */ element) {
		                window.setTimeout(callback, 1000 / 60);
		              };
		    })();

		function init() {
			// Create Table
			var table = document.createElement('div');
			table.id = 'table';
			document.body.appendChild(table);
			
			//INIT BALLS & PHYSICS
		    initBalls();
		}

		function initBalls() {
		    var minDist = window.innerHeight / maxBalls;

			//ADD maxBalls
			for (var i=0;i<maxBalls;i++) { 
				var ball = document.createElement("div");
				ball.className = "ball blue";
				
				ball.left = Math.round(Math.random()*window.innerWidth-30);
	            ball.top = Math.random() * (i*minDist+50 - i*minDist) + i*minDist;
		        console.log(ball.top)
				ball.collision = 0;
	    		ball.mass = 1;
	    		ball.xspeed = Math.round(Math.random()*8-4);
	    		ball.yspeed = Math.round(Math.random()*8-4);
					
	    		var innerdiv = document.createElement('div');
	    		var innerspan = document.createElement('span');
	    		innerspan.innerHTML = '7';
				innerdiv.appendChild(innerspan);
				ball.appendChild(innerdiv);
				document.getElementById('table').appendChild(ball);
				
				ballsArray.push(ball);
			}

			if (ballsArray.length == maxBalls){
				tick();
			}
		}

		function moveBall() {		
			for (var i=0;i<maxBalls;i++) { 
				// BOUNDRIES Left
				if (ballsArray[i].left<0) {
					ballsArray[i].left = 0;ballsArray[i].xspeed *= -1;
				}
				// BOUNDRIES Right		
				if (ballsArray[i].left>tablewidth-30) {
					ballsArray[i].left = tablewidth-30;ballsArray[i].xspeed *= -1;
				}	
				// BOUNDRIES Top
				if (ballsArray[i].top<0) {
					ballsArray[i].top = 0;ballsArray[i].yspeed *= -1;
				}		
				// BOUNDRIES Bottom
				if (ballsArray[i].top>tableheight-30) {
					ballsArray[i].top = tableheight-30;ballsArray[i].yspeed *= -1;
				}	
				
				//GET THE NEW POSITION
				ballsArray[i].left += ballsArray[i].xspeed;
				ballsArray[i].top += ballsArray[i].yspeed;
				
				//APPLY THE NEW POSITION
				//ballsArray[i].style.WebkitTransform = "translate("+ballsArray[i].left+"px,"+ballsArray[i].top+"px)";//2D Transform
				ballsArray[i].style.WebkitTransform = "translate3D("+ballsArray[i].left+"px,"+ballsArray[i].top+"px,0px)";//3D Transform fo better Performance?? -> "testing"
	            ballsArray[i].style.MozTransform = "translate3D("+ballsArray[i].left+"px,"+ballsArray[i].top+"px,0px)";
			}
	   		//ball.style.WebkitTransform = "translate("+ball.dx+"px,"+ball.dy+"px)";
		}

		function manage_bounce(ball, ball2) {
		    dx = ball.left-ball2.left;
		    dy = ball.top-ball2.top;
		    collisionision_angle = Math.atan2(dy, dx);
		    magnitude_1 = Math.sqrt(ball.xspeed*ball.xspeed+ball.yspeed*ball.yspeed);
		    magnitude_2 = Math.sqrt(ball2.xspeed*ball2.xspeed+ball2.yspeed*ball2.yspeed);
		    direction_1 = Math.atan2(ball.yspeed, ball.xspeed);
		    direction_2 = Math.atan2(ball2.yspeed, ball2.xspeed);
		    new_xspeed_1 = magnitude_1*Math.cos(direction_1-collisionision_angle);
		    new_yspeed_1 = magnitude_1*Math.sin(direction_1-collisionision_angle);
		    new_xspeed_2 = magnitude_2*Math.cos(direction_2-collisionision_angle);
		    new_yspeed_2 = magnitude_2*Math.sin(direction_2-collisionision_angle);
		    final_xspeed_1 = ((ball.mass-ball2.mass)*new_xspeed_1+(ball2.mass+ball2.mass)*new_xspeed_2)/(ball.mass+ball2.mass);
		    final_xspeed_2 = ((ball.mass+ball.mass)*new_xspeed_1+(ball2.mass-ball.mass)*new_xspeed_2)/(ball.mass+ball2.mass);
		    final_yspeed_1 = new_yspeed_1;
		    final_yspeed_2 = new_yspeed_2;
		    ball.xspeed = Math.cos(collisionision_angle)*final_xspeed_1+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_1;
		    ball.yspeed = Math.sin(collisionision_angle)*final_xspeed_1+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_1;
		    ball2.xspeed = Math.cos(collisionision_angle)*final_xspeed_2+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_2;
		    ball2.yspeed = Math.sin(collisionision_angle)*final_xspeed_2+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_2;
		}


		function tick() {
		    moveBall();
		    
		    for (x=0; x<=maxBalls; x++) {
		        for (y=x+1; y<maxBalls; y++) {
		        	distance_x = Math.abs(ballsArray[x].left-ballsArray[y].left);
		        	distance_y = Math.abs(ballsArray[x].top-ballsArray[y].top);
		        	distance = Math.sqrt(distance_x*distance_x+distance_y*distance_y);
		        	
		        	if (distance<=31 && (ballsArray[x].collision == 0 || ballsArray[y].collision == 0)) {
		        		ballsArray[x].collision = 1;
		                ballsArray[y].collision = 1;
		                manage_bounce(ballsArray[x], ballsArray[y]);
		        	} else if (distance>31) {
		                ballsArray[x].collision = 0;
		                ballsArray[y].collision = 0;
		            }
		        	
		        	//window.console.log(distance)
		        }
		     }
		    
		    requestAnimFrame( tick );//RUN THE NEXT TICK
		}

	</script>

</head>
<body onload="init()">
</body>
</html>